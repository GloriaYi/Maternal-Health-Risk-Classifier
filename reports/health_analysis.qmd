---
title: Predicting risk factors for maternal mortality
authors: Apoorva Srivastava, Gloria (Guaner) Yi, Jeffrey Ding & Randall Lee
jupyter: python3
format:
    pdf:
        toc: true
        toc-depth: 2
    html:
        toc: true
        toc-depth: 2
        embed-resources: true
bibliography: references.bib
execute:
    echo: false
    warning: false
editor: source
---

```{python}
#| output: false

import pandas as pd

# Load all data files once
raw_data = pd.read_csv("../data/raw/Maternal Health Risk Data Set.csv")
train_df = pd.read_csv("../data/processed/maternal_health_risk_train.csv", index_col=0)
test_df = pd.read_csv("../data/processed/maternal_health_risk_test.csv", index_col=0)
train_describe = pd.read_csv("../results/tables/train_describe.csv", index_col=0)
test_scores = pd.read_csv("../results/tables/test_scores.csv")
auc_scores = pd.read_csv("../results/tables/auc_scores.csv", index_col=0)
confusion = pd.read_csv("../results/tables/confusion_matrix.csv", index_col=0)

# Compute validation metrics
n_duplicates = raw_data.duplicated().sum()
n_obs = int(train_describe["count"].iloc[0])

# Extract performance metrics
recall_weighted = round(test_scores["recall_weighted"].iloc[0], 4)
accuracy = round(test_scores["accuracy"].iloc[0], 4)

# AUC scores
auc_high = round(auc_scores.loc["AUC", "high risk"], 4)
auc_low = round(auc_scores.loc["AUC", "low risk"], 4)
auc_mid = round(auc_scores.loc["AUC", "mid risk"], 4)

# Confusion matrix analysis
high_risk_correct = confusion.loc["high risk", "high risk"]
high_risk_as_low = confusion.loc["high risk", "low risk"]
high_risk_as_mid = confusion.loc["high risk", "mid risk"]
high_risk_total = high_risk_correct + high_risk_as_low + high_risk_as_mid
high_risk_recall = round(high_risk_correct / high_risk_total, 3)

# Total test cases and correct predictions
total_test = confusion.sum().sum()
total_correct = confusion.iloc[0, 0] + confusion.iloc[1, 1] + confusion.iloc[2, 2]
total_high_errors = high_risk_as_low + high_risk_as_mid

```

# Abstract

Despite advancements in medicine and technology, maternal mortality remains a prevalent issue impacting many women in developing countries. The general consensus is that maternal mortality is a multidimensional issue that is complicated by many socioeconomic determinants of health and barriers to access. This project aims to investigate the viability of using a Support Vector Classifier (SVC) trained on open-source maternal health measurements to predict the risk intensity levels (low, medium, or high) of pregnant women. Our final classifier performed fairly well on an unseen test data set, with a weighted recall score of `{python} recall_weighted` and an overall accuracy of `{python} accuracy`. Out of the `{python} total_test` test data cases, it correctly predicted `{python} total_correct` cases. The model showed particularly strong performance in identifying high-risk pregnancies, achieving an AUC of `{python} auc_high` for the high-risk class, compared to `{python} auc_low` for low-risk class and `{python} auc_mid` for medium-risk class. However, the model made notable errors where `{python} total_high_errors` high-risk cases were misclassified as `{python} high_risk_as_mid` medium-risk and `{python} high_risk_as_low` low-risk. These false negatives are gaps where high-risk individuals may not receive the necessary care. We recommend further research to improve the model's sensitivity to high-risk cases and better differentiate between medium and low-risk categories before it is ready to be put into production in clinical settings. Additional feature engineering or exploring ensemble methods may help reduce these critical misclassifications. The implementation of refined classifiers would expand the capabilities of most healthcare systems and increase the efficacy of monitoring and interventions in underprivileged communities.

# Introduction

Maternal mortality is a serious issue that predates human history and still affects many mothers today. Among women of reproductive age, 9% of global deaths are currently attributable to maternal causes such as hemorrhaging, hypertension, and unsafe abortion [@hassfurter2025trends]. Fortunately, gradual improvements in medical understanding, policy, healthcare, and overall quality of life have led to steadily decreasing maternal mortality rates. Recent UNICEF reports from 2023 place the global maternal mortality ratio at 197 per 100,000 live births, which is approximately 40% less than the reported ratio from 2000. Although many countries report mortality rates on par with the global average, there are an overwhelming number of rural and underserved communities within these countries that continue to experience disproportionate rates of maternal mortality.

One such country is Bangladesh, which has an overall maternal mortality ratio of 196 per 100,000 live births that appears to match the global rates; however, deeper investigation reveals significant differences in mortality rate between women of different socioeconomic backgrounds. A study conducted by Aniqa Tasnim Hossain and their team from Bangladesh's International Centre for Diarrhoeal Disease Research noted the following findings:

> "women living in rural areas and those of poorer socioeconomic status were more likely to die due to maternal causes of deaths. Most deaths occurred on the day of and one day after delivery. We identified haemorrhage and eclampsia as the major contributors to maternal deaths. We also found a large proportion of deaths occurring in-transit with substantial shuttling for care seeking before their deaths. [@hossain2023maternal]"
    
In their conclusions, @hossain2023maternal recommended investing in a structured referral system and emergency transportation to prioritize delivering timely interventions for haemorrhaging or eclampsia. This sentiment is echoed in a paper published in *The Lancet* that performed a global analysis of the determinants in maternal health and mortality [@souza2023global]. @souza2023global argues that focusing research on the biomedical causes of mortality is insufficient, and more attention should be directed towards goals such as "primary prevention, early identification, and adequate management of pregnancy, labour, and postpartum complications". 

Both reports highlight a growing need for the ability to identify and prioritize high-risk mothers in order to accurately and punctually deliver care. A welcome innovation has been the development of wearable technology and internet-enabled devices. These devices have allowed patients and physicians to reliably monitor health conditions from their homes and enabled the collection of physiological data from otherwise underserved communities. In 2020, @ahmed2020data used these devices as well as available medical records to build a maternal health dataset of rural Bangladesh, which was later uploaded to the UC Irvine Machine Learning Repository. This project seeks to predict maternal health risk levels using an SVC model and the Maternal Health Risk dataset. The ability to accurately predict high-risk pregnancies would allow timely and focused medical interventions for vulnerable individuals.

# Methods

## Data
The data set used in this project is of health conditions of pregnant women from the rural areas of Bangladesh created by Marzia Ahmed at Daffodil International University. This dataset was sourced from the UC Irvine Machine Learning Repository and can be found [here](https://archive.ics.uci.edu/dataset/863/maternal+health+risk). Each observation in the dataset corresponds to a pregnant individual's health profile, comprising a risk intensity level (low, medium, or high risk) and associated clinical measurements including demographic information (age) and vital signs (systolic blood pressure, diastolic blood pressure, blood glucose concentration, body temperature, and resting heart rate). The data set was collected via an IoT-based risk monitoring system from hospitals, community clinics, and maternal health cares in rural Bangladesh.

### Data dictionary
| Column Name | Role    | Type        | Description |
|-------------|---------|-------------|-------------|
| Age         | Feature | Integer     | Age of the patient during pregnancy (in years) |
| SystolicBP  | Feature | Integer     | Systolic (upper) blood pressure measured in mmHg |
| DiastolicBP | Feature | Integer     | Diastolic (lower) blood pressure measured in mmHg |
| BS          | Feature | Integer     | Blood sugar level measured in mmol/L |
| BodyTemp    | Feature | Integer     | Body temperature of the patient measured in °F |
| HeartRate   | Feature | Integer     | Patient's resting heart rate measured in bpm |
| RiskLevel   | Target  | Categorical | Predicted pregnancy risk level based on clinical features |

## Analysis
SVC was used to build a classification model to predict risk levels for pregnant women in rural Bangladesh. With the exception of diastolic blood pressure, all variables from the original dataset were included for analysis. The features used were age, systolic blood pressure, blood glucose level (BS), body temperature, and heart rate. Data was partitioned into a 70:30 train-test split and the random_state was set to 123 for reproducibility. We performed hyperparameter tuning using randomized search with 10-fold cross-validation and recall score (weighted) as our evaluation metric to select the optimal values for C (regularization parameter), gamma (kernel coefficient). Recall score was selected to optimize the model for sensitivity in predicting high-risk cases. All explanatory variables were numerical and were standardized via StandardScaler prior to fitting. The Python programming language and the following Python packages were used to perform the analysis: requests [@reitz2023requests], numpy [@harris2020array], Pandas [@mckinney2010data], pandera [@niels_bantilan_2023_pandera], altair [@vanderplas2018altair], matplotlib [@hunter2007matplotlib], seaborn [@waskom2021seaborn], deepchecks [@deepchecks], scikit-learn [@pedregosa2011scikit], and scipy [@virtanen2020scipy].

# Results

## Split Data

Ahmed's Maternal Health Risk dataset was read into a data frame and split 70:30 into a training dataset and testing dataset, respectively. The training dataset consisted of `{python} len(train_df)` patients and was used to build and train the model. The test dataset consisted of `{python} len(test_df)` patients and was used to  maintained separately for objective evaluation of the model's performance. A random seed was saved to ensure reproducibility of the data split.

```{python}
#| label: tbl-raw-data
#| tbl-cap: "Raw Maternal Health Risk Data (first 10 rows)"
raw_data.head(10)
```

```{python}
#| label: tbl-risk-counts
#| tbl-cap: "Risk Level Counts in Training Data"
train_df['RiskLevel'].value_counts().to_frame(name='Count')
```

## EDA
Preliminary exploratory data analysis (EDA) was performed to briefly examine each explanatory variable. Previous research has described hypertension as a complication risk; therefore, we elected to keep systolic systolic blood pressure over diastolic blood pressure. This is because systolic blood pressure is a key measurement used to assess hypertension, whereas diastolic blood pressure is often less clinically relavent. Distributions of each explanatory variable were plotted using histograms and coloured according to risk levels @fig-eda-distributions (blue: high risk, green: medium risk, orange: low risk). The plotted distributions were visually distinct across risk levels. Thus, we continued to fit our model with the remaining features.

![Feature Distributions by Risk Level](../results/figures/feature_densities_by_risklevel.png){#fig-eda-distributions fig-cap="Comparison of the distributions of features contributing to the risk intensity level."}


## Data Validation

### Validation Ranges

For `Age`, we chose a validation range of 10-65 years. The lower limit of 10 accounts for rare cases of very early pregnancy, though pregnancies below the age of 15 are generally medically concerning. The upper limit of 65 represents the maximum biologically feasible range for pregnancy, though pregnancies beyond menopause are extremely rare and would usually require medical intervention. In very rare cases, values outside this range may occur but we can consider them extreme outliers, not suitable for our prediction task.

For `SystolicBP`, we chose a validation range of 60-200 mmHg. Systolic blood pressure below 60 mmHg indicates severe hypotension, whereas systolic blood pressure above 200 mmHg indicates severe hypertension, both of which are life-threatening emergencies requiring immediate medical intervention. Since our model aims to classify routine maternal health risk levels, values outside the validation range are outside the scope of our classification model and would be considered outliers.

For `DiastolicBP`, we chose a validation range of 40-140 mmHg. Diastolic blood pressure below 40 mmHg indicates severe hypotension, whereas diastolic blood pressure above 140 mmHg indicates severe hypertension, both of which are life-threatening emergencies requiring immediate medical intervention. Since our model aims to classify routine maternal health risk levels, values outside the validation range are outside the scope of our classification model and would be considered outliers.

For `BS`, we chose a validation range of 1-25 mmol/L. Blood sugar below 1 mmol/L indicates severe hypoglycemia, whereas blood sugar above 25 mmol/L indicates severe hyperglycemia. Both of these are life-threatening emergencies requiring immediate hospitalization and can therefore be considered unsuitable for our predictive model.

For `BodyTemp`, we chose a validation range of 95.0-105.0°F. Body temperature below 95.0°F indicates severe hypothermia, whereas body temperature above 105.0°F indicates severe hyperthermia. Both of these are life-threatening emergencies requiring immediate hospitalization and can therefore be considered as unsuitable for our predictive model.

For `HeartRate`, we chose a validation range of 50-150 bpm. A resting heart rate below 50 bpm or above 150 bpm suggests potential cardiovascular problems requiring immediate medical intervention. Neither of the extreme values is compatible with normal maternal health assessment, and such values can be considered outliers.

The target variable `RiskLevel` is a categorical variable representing the maternal health risk classification based on clinical assessment. Each observation must contain exactly one of these three risk levels: `low risk`, `mid risk` and `high risk`.

To ensure that the target variable is not severely imbalanced, we applied a minimum class frequency check (at least 5% per class). This avoids situations where certain risk levels are too rare for the model to learn meaningful patterns, which could lead to biased predictions.

#### Validation Range Results

We dropped 4 observations during our preliminary data validation, as these rows contain invalid data entries that would introduce noise into our model. More details about which observations have been dropped can be found under `validation_errors.log` in the `notebooks` folder. 

The validation log shows that the dropped observations include:
- 2 rows with `Age` outside the expected range (10-65 years): ages 66 and 70
- 2 rows with `HeartRate` of 7 bpm, which seems an impossibility for living people

#### Duplicate Observations

We have retained the `{python} n_duplicates` duplicate rows found in our data validation checks. Since the [original data set](https://archive.ics.uci.edu/dataset/863/maternal+health+risk) lacks unique patient identifiers (no patient ID or timestamp), we cannot definitely determine whether these duplicates represent the same patient measured multiple times or different patients with identical measurements. Given this uncertainty and the substantial dataset reduction that would result from removing the duplicates, we opted to keep all duplicate rows and only remove observations that clearly fail other data validation checks. 

The dataset passed all other validation checks, namely:
- Correct data file format
- Correct column names
- No empty observations
- Missingness not beyond expected threshold: all columns have <5% missing values (threshold = 0.05)
- Correct data types in each column
- Correct category levels: all categorical values match expected levels
- No outliers: all numeric values fall within reasonable ranges (with the exception of the 4 dropped rows)
- Target/response variable follows expected distribution

Our final validated dataset `validated_data` contains `{python} n_obs` observations. 

### Correlations

To ensure that our predictive modeling process does not rely on spurious or overly strong relationships, we performed two correlation-based data validation checks on the training split only (to avoid test-set leakage):

#### Target-Feature Correlation

We first applied the `FeatureLabelCorrelation` check from Deepchecks (used Pandera for a similar test if Deepchecks can't be used). This check evaluates whether any feature has an strong relationship with the target variable (RiskLevel), which could be a sign of target leakage. Threshold used: correlation < 0.9. All features met the threshold. No anomalous or suspiciously high correlations were detected between features and the target.

#### Feature-Feature Correlation

We also used Deepchecks' `FeatureFeatureCorrelation` to check for unusually high correlations between pairs of features, which may indicate redundancy or multicolinearity in modeling. Threshold used: correlation < 0.95. Feature–feature correlations met the threshold. No pairs of features exhibited extremely high correlation that would require removal or special handling.

![Feature Correlation Heatmap](../results/figures/correlation_heatmap.png){#fig-corr-heatmap fig-cap="Heatmap showing correlations between features in the training dataset."}

### Overall Conclusion

The validated dataset was confirmed to be within acceptable ranges and both correlation checks passed. There were no failing rows, and no features required modification or exclusion based on these validation steps. This suggests that the dataset has no correlation-based anomalies, and is appropriate for next step of model training.

## Model construction

We selected a Support Vector Classifier (SVC) model for this classification task. To identify the model configuration that best predicted maternal health risk levels, we performed hyperparameter tuning using randomized search with 10-fold cross-validation and recall score (weighted) as our evaluation metric to select the optimal values for C (regularization parameter), gamma (kernel coefficient). We found that the optimal hyperparameters were 760 for C and 5.8 for gamma.

```{python}
#| label: tbl-svc-score
#| tbl-cap: "Class-wise AUC"
auc_scores
```

### Hyperparameter tuning

In order to classify clinical risk levels, recall score was selected as the preferred evaluation metric. This is because recall score measures the percentage correctly identified of actual high-risk pregnancies. This is critical for maternal health prediction where false negatives could result in missing high-risk, vulnerable individuals. Although prioritizing recall could increase the rate of false positive errors, it is the safer choice in this context.

![Hyperparameter Optimization](../results/figures/svc_hyperparameter_tuning.png){#fig-hyperparam-heatmap fig-cap="Results from hyperparameter optimization and 10-fold cross validation. Recall score was used as the classification metric."}


![Crosstab of Actual vs Predicted Risk Levels](../results/figures/confusion_matrix.png){#fig-confusion-matrix fig-cap="Confusion matrix of model performance on test data."}

![Classifier ROC Curves](../results/figures/roc_curves.png){#fig-roc-curve fig-cap="ROC curve of model performance on test data."}

### Summary of Model Results

The final SVC classifier performed fairly well on an unseen test data set, with a weighted recall score of `{python} recall_weighted` and an overall accuracy of `{python} accuracy`. Out of the `{python} total_test` test data cases, it correctly predicted `{python} total_correct` cases. The model showed particularly strong performance in identifying high-risk pregnancies, achieving an AUC of `{python} auc_high` for the high-risk class, compared to `{python} auc_low` for low-risk class and `{python} auc_mid` for medium-risk class. It correctly identifies `{python} high_risk_correct` out of `{python} high_risk_total` actual high-risk pregnancies resulting in a `{python} round(high_risk_recall * 100)` % recall for high risk. There were `{python} total_high_errors` notable errors in which true high-risk cases were misclassified as `{python} high_risk_as_mid` medium-risk and `{python} high_risk_as_low` low-risk.

# Discussion

The latest iteration of the SVC model delivered promising results and demonstrated considerable accuracy when classifying high-risk individuals. Correct identification of high-risk individuals is pivotal in the prevention and early intervention of pregnancy complications, such as hemorrhaging and eclampsia. The model's ability to correctly classify high-risk individuals is encouraging, and future iterations could help alert doctors or emergency responders to improve accessibility for underserved communities.

Further refinement is required, however, as the model made `{python} total_high_errors` notable classification errors during testing. These truly high-risk cases were misclassified as `{python} high_risk_as_mid` medium-risk and `{python} high_risk_as_low` low-risk. In reality, these false negatives are gaps where high-risk individuals could be overlooked and not prioritized appropriately. Future versions should seek to improve the model's sensitivity to high-risk cases and better differentiate between medium and low-risk categories before it is ready to be implemented in clinical settings.

A limitation of this model is that other devices and their sensors may have different measurement accuracies and calibration standards. The model was trained on data collected from specific IoT devices in rural Bangladesh; therefore, its performance may vary when applied to data from different devices or populations. Additionally, other countries may have health information documentation standards that differ from Bangladesh. Future work should consider validating the model across diverse datasets and device types to ensure its robustness and generalizability.

# Conclusion

Global maternal mortality rates are on the decline; however, there remains unmet needs within many developing and underserved communities. Greater emphasis on primary prevention and  early identification would enable better management of pregnancy complications and improve health outcomes overall. This report demonstrates the potential of machine learning models and at-home monitoring devices. With further improvement, these tools could create opportunities for more focused, effective, and resourceful delivery of care.

# References


